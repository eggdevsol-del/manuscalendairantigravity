<mxfile host="app.diagrams.net" modified="2026-02-08T06:32:09.000Z" agent="Antigravity" version="24.0.0" etag="automatic-date-finding-v1">
  <diagram name="Automatic Date Finding Algorithm" id="automatic-date-finding">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="1654" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Automatic Date Finding Algorithm" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="334" y="20" width="500" height="40" as="geometry" />
        </mxCell>
        
        <!-- START -->
        <mxCell id="start" value="START&#xa;findProjectAvailability" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="484" y="80" width="200" height="80" as="geometry" />
        </mxCell>
        
        <!-- Input Parameters -->
        <mxCell id="input" value="INPUT PARAMETERS:&#xa;• conversationId&#xa;• serviceName&#xa;• serviceDuration (minutes)&#xa;• sittings (count)&#xa;• price&#xa;• frequency (consecutive/weekly/biweekly/monthly)&#xa;• startDate" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;align=left" vertex="1" parent="1">
          <mxGeometry x="404" y="200" width="360" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="start" target="input">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Fetch Conversation -->
        <mxCell id="fetch_conv" value="Fetch conversation by ID" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="484" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="input" target="fetch_conv">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Check Conversation Exists -->
        <mxCell id="check_conv" value="Conversation&#xa;exists?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="504" y="460" width="160" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="fetch_conv" target="check_conv">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Error: Conversation Not Found -->
        <mxCell id="error_conv" value="ERROR&#xa;NOT_FOUND:&#xa;Conversation not found" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="760" y="480" width="180" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="edge4" value="NO" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontStyle=1" edge="1" parent="1" source="check_conv" target="error_conv">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Fetch Artist Settings -->
        <mxCell id="fetch_settings" value="Fetch artist settings&#xa;(work schedule)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="484" y="600" width="200" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="edge5" value="YES" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontStyle=1" edge="1" parent="1" source="check_conv" target="fetch_settings">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Parse Work Schedule -->
        <mxCell id="parse_schedule" value="Parse work schedule JSON&#xa;Convert to WorkDay[] array" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="484" y="700" width="200" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="fetch_settings" target="parse_schedule">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Check Schedule Empty -->
        <mxCell id="check_schedule" value="Schedule&#xa;valid &amp;&#xa;not empty?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="504" y="800" width="160" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="parse_schedule" target="check_schedule">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Error: Work Hours Not Set -->
        <mxCell id="error_schedule" value="ERROR&#xa;PRECONDITION_FAILED:&#xa;Work hours not set up" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="760" y="820" width="180" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="edge8" value="NO" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontStyle=1" edge="1" parent="1" source="check_schedule" target="error_schedule">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Calculate Max Daily Minutes -->
        <mxCell id="calc_max" value="Calculate maxDailyMinutes&#xa;(longest work day)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="484" y="940" width="200" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="edge9" value="YES" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontStyle=1" edge="1" parent="1" source="check_schedule" target="calc_max">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Validate Service Duration -->
        <mxCell id="check_duration" value="serviceDuration&#xa;&lt;=&#xa;maxDailyMinutes?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="484" y="1040" width="200" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="edge10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="calc_max" target="check_duration">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Error: Service Too Long -->
        <mxCell id="error_duration" value="ERROR&#xa;PRECONDITION_FAILED:&#xa;Service duration exceeds&#xa;longest work day" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="760" y="1050" width="180" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="edge11" value="NO" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontStyle=1" edge="1" parent="1" source="check_duration" target="error_duration">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Initialize Search -->
        <mxCell id="init_search" value="INITIALIZE SEARCH:&#xa;• searchStart = max(startDate, now)&#xa;• Fetch existing appointments&#xa;• Create busySlots array&#xa;• suggestedDates = []&#xa;• currentDateSearch = searchStart&#xa;• totalCost = price × sittings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left" vertex="1" parent="1">
          <mxGeometry x="434" y="1180" width="300" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="edge12" value="YES" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontStyle=1" edge="1" parent="1" source="check_duration" target="init_search">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Main Loop Start -->
        <mxCell id="loop_start" value="FOR each sitting&#xa;(i = 0 to sittings - 1)" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=13" vertex="1" parent="1">
          <mxGeometry x="464" y="1340" width="240" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="edge13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="init_search" target="loop_start">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Call findNextAvailableSlot -->
        <mxCell id="call_find_slot" value="CALL findNextAvailableSlot(&#xa;  currentDateSearch,&#xa;  serviceDuration,&#xa;  workSchedule,&#xa;  busySlots&#xa;)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;align=left" vertex="1" parent="1">
          <mxGeometry x="454" y="1460" width="260" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="edge14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="loop_start" target="call_find_slot">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- findNextAvailableSlot Subprocess -->
        <mxCell id="subprocess_box" value="SUBPROCESS: findNextAvailableSlot" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;fontSize=14;startSize=30" vertex="1" parent="1">
          <mxGeometry x="80" y="1600" width="1000" height="920" as="geometry" />
        </mxCell>
        
        <!-- Subprocess Start -->
        <mxCell id="sub_start" value="START&#xa;findNextAvailableSlot" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11" vertex="1" parent="subprocess_box">
          <mxGeometry x="420" y="50" width="160" height="60" as="geometry" />
        </mxCell>
        
        <!-- Initialize Search Pointer -->
        <mxCell id="sub_init" value="Initialize:&#xa;• searchPointer = startDate&#xa;• Align to 30-min intervals&#xa;• endSearchLimit = +1 year" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left" vertex="1" parent="subprocess_box">
          <mxGeometry x="390" y="140" width="220" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="subprocess_box" source="sub_start" target="sub_init">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- While Loop -->
        <mxCell id="sub_while" value="searchPointer&#xa;&lt;&#xa;endSearchLimit?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="subprocess_box">
          <mxGeometry x="410" y="250" width="180" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="subprocess_box" source="sub_init" target="sub_while">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Get Day Name -->
        <mxCell id="sub_day" value="Get day name from&#xa;searchPointer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="subprocess_box">
          <mxGeometry x="410" y="370" width="180" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge3" value="YES" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1" edge="1" parent="subprocess_box" source="sub_while" target="sub_day">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Find Schedule for Day -->
        <mxCell id="sub_find_sched" value="Find schedule for day&#xa;in workSchedule" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="subprocess_box">
          <mxGeometry x="410" y="450" width="180" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="subprocess_box" source="sub_day" target="sub_find_sched">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Check Day Enabled -->
        <mxCell id="sub_check_enabled" value="Day enabled&#xa;&amp; schedule&#xa;valid?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="subprocess_box">
          <mxGeometry x="420" y="530" width="160" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="subprocess_box" source="sub_find_sched" target="sub_check_enabled">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Parse Start/End Times -->
        <mxCell id="sub_parse" value="Parse start &amp; end times&#xa;Calculate currentTotal,&#xa;startTotal, endTotal (minutes)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left" vertex="1" parent="subprocess_box">
          <mxGeometry x="240" y="540" width="140" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge6" value="YES" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1" edge="1" parent="subprocess_box" source="sub_check_enabled" target="sub_parse">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Check Within Hours -->
        <mxCell id="sub_check_hours" value="currentTotal&#xa;within&#xa;work hours?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="subprocess_box">
          <mxGeometry x="230" y="640" width="160" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="subprocess_box" source="sub_parse" target="sub_check_hours">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Check Slot Fits -->
        <mxCell id="sub_check_fits" value="Slot + duration&#xa;fits before&#xa;end time?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="subprocess_box">
          <mxGeometry x="50" y="640" width="140" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge8" value="YES" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1" edge="1" parent="subprocess_box" source="sub_check_hours" target="sub_check_fits">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Check Collision -->
        <mxCell id="sub_check_collision" value="Check for collision&#xa;with existing&#xa;appointments" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="subprocess_box">
          <mxGeometry x="50" y="760" width="140" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge9" value="YES" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1" edge="1" parent="subprocess_box" source="sub_check_fits" target="sub_check_collision">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Has Collision Decision -->
        <mxCell id="sub_has_collision" value="Has&#xa;collision?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="subprocess_box">
          <mxGeometry x="60" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="subprocess_box" source="sub_check_collision" target="sub_has_collision">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Return Slot -->
        <mxCell id="sub_return" value="RETURN&#xa;searchPointer&#xa;(slot found!)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1" vertex="1" parent="subprocess_box">
          <mxGeometry x="240" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge11" value="NO" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1" edge="1" parent="subprocess_box" source="sub_has_collision" target="sub_return">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Increment Time -->
        <mxCell id="sub_increment" value="Increment searchPointer&#xa;by 30 minutes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="subprocess_box">
          <mxGeometry x="680" y="750" width="160" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge12" value="YES" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="subprocess_box" source="sub_has_collision" target="sub_increment">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge13" value="NO" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="subprocess_box" source="sub_check_fits" target="sub_increment">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="220" y="685" />
              <mxPoint x="220" y="775" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="sub_edge14" value="NO" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="subprocess_box" source="sub_check_hours" target="sub_increment">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="420" y="685" />
              <mxPoint x="420" y="775" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="sub_edge15" value="NO" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="subprocess_box" source="sub_check_enabled" target="sub_increment">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="760" y="575" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Loop Back -->
        <mxCell id="sub_edge16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="subprocess_box" source="sub_increment" target="sub_while">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="760" y="295" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Return Null -->
        <mxCell id="sub_return_null" value="RETURN null&#xa;(no slot found)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1" vertex="1" parent="subprocess_box">
          <mxGeometry x="740" y="265" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="sub_edge17" value="NO" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontStyle=1" edge="1" parent="subprocess_box" source="sub_while" target="sub_return_null">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Edge from subprocess to main flow -->
        <mxCell id="edge15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;strokeWidth=2" edge="1" parent="1" source="call_find_slot" target="subprocess_box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Check Slot Found -->
        <mxCell id="check_slot" value="Slot&#xa;found?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="504" y="2560" width="160" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="edge16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="subprocess_box" target="check_slot">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="584" y="2520" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Error: No Slot Found -->
        <mxCell id="error_slot" value="ERROR&#xa;PRECONDITION_FAILED:&#xa;Could not find slot&#xa;for sitting i+1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="760" y="2565" width="180" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="edge17" value="NO" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontStyle=1" edge="1" parent="1" source="check_slot" target="error_slot">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Add to Suggested Dates -->
        <mxCell id="add_date" value="Add slot to suggestedDates" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="484" y="2680" width="200" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="edge18" value="YES" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontStyle=1" edge="1" parent="1" source="check_slot" target="add_date">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Add to Busy Slots -->
        <mxCell id="add_busy" value="Add slot to busySlots&#xa;(prevent self-overlap)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="484" y="2770" width="200" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="edge19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="add_date" target="add_busy">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Calculate Next Search Date -->
        <mxCell id="calc_next" value="Calculate next search date&#xa;based on frequency:&#xa;• consecutive: +1 day&#xa;• weekly: +7 days&#xa;• biweekly: +14 days&#xa;• monthly: +1 month" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left" vertex="1" parent="1">
          <mxGeometry x="444" y="2860" width="280" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="edge20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="add_busy" target="calc_next">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Update Current Date Search -->
        <mxCell id="update_current" value="currentDateSearch = nextDate&#xa;(reset to midnight)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="464" y="3000" width="240" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="edge21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="calc_next" target="update_current">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Loop Back to Next Sitting -->
        <mxCell id="edge22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="update_current" target="loop_start">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="360" y="3025" />
              <mxPoint x="360" y="1380" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- All Sittings Complete -->
        <mxCell id="complete" value="All sittings processed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="484" y="3100" width="200" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="edge23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="loop_start" target="complete">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="800" y="1380" />
              <mxPoint x="800" y="3125" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Return Result -->
        <mxCell id="return_result" value="RETURN&#xa;{ dates: suggestedDates,&#xa;  totalCost: totalCost }" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;align=left" vertex="1" parent="1">
          <mxGeometry x="454" y="3190" width="260" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="edge24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="complete" target="return_result">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- END -->
        <mxCell id="end" value="END" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="524" y="3300" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="edge25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="return_result" target="end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Legend -->
        <mxCell id="legend_box" value="LEGEND" style="swimlane;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;fontSize=12;startSize=30" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="280" height="280" as="geometry" />
        </mxCell>
        
        <mxCell id="legend1" value="Start/End" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10" vertex="1" parent="legend_box">
          <mxGeometry x="20" y="40" width="100" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend2" value="Process" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10" vertex="1" parent="legend_box">
          <mxGeometry x="20" y="90" width="100" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend3" value="Decision" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10" vertex="1" parent="legend_box">
          <mxGeometry x="20" y="140" width="100" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="legend4" value="Input/Output" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10" vertex="1" parent="legend_box">
          <mxGeometry x="20" y="200" width="100" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend5" value="Error" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10" vertex="1" parent="legend_box">
          <mxGeometry x="150" y="40" width="100" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend6" value="Loop" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10" vertex="1" parent="legend_box">
          <mxGeometry x="150" y="90" width="100" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend7" value="Calculation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10" vertex="1" parent="legend_box">
          <mxGeometry x="150" y="140" width="100" height="40" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
